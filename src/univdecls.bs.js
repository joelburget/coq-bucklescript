// Generated by BUCKLESCRIPT VERSION 2.2.2, PLEASE EDIT WITH CARE
'use strict';

var List = require("bs-platform/lib/js/list.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Js_exn = require("bs-platform/lib/js/js_exn.js");
var Evd$ReactTemplate = require("./evd.bs.js");
var Univ$ReactTemplate = require("./univ.bs.js");
var UState$ReactTemplate = require("./uState.bs.js");
var CErrors$ReactTemplate = require("./cErrors.bs.js");
var Environ$ReactTemplate = require("./environ.bs.js");
var Termops$ReactTemplate = require("./termops.bs.js");
var Pretyping$ReactTemplate = require("./pretyping.bs.js");

var default_univ_decl_002 = /* univdecl_constraints */Univ$ReactTemplate.Constraint[/* empty */0];

var default_univ_decl = /* record */[
  /* univdecl_instance : [] */0,
  /* univdecl_extensible_instance : true */1,
  default_univ_decl_002,
  /* univdecl_extensible_constraints : true */1
];

function interp_univ_constraints(_, evd, cstrs) {
  var interp = function (param, param$1) {
    var evd = param[0];
    var ul = Pretyping$ReactTemplate.interp_known_glob_level(/* None */0, evd, param$1[0]);
    var u$primel = Pretyping$ReactTemplate.interp_known_glob_level(/* None */0, evd, param$1[2]);
    var cstr_001 = param$1[1];
    var cstr = /* tuple */[
      ul,
      cstr_001,
      u$primel
    ];
    var cstrs$prime = Curry._2(Univ$ReactTemplate.Constraint[/* add */3], cstr, param[1]);
    try {
      var evd$1 = Evd$ReactTemplate.add_constraints(evd, Curry._1(Univ$ReactTemplate.Constraint[/* singleton */4], cstr));
      return /* tuple */[
              evd$1,
              cstrs$prime
            ];
    }
    catch (raw_exn){
      var exn = Js_exn.internalToOCamlException(raw_exn);
      if (exn[0] === Univ$ReactTemplate.UniverseInconsistency) {
        return CErrors$ReactTemplate.user_err(/* None */0, /* Some */["interp_constraint"], Univ$ReactTemplate.explain_universe_inconsistency(Termops$ReactTemplate.pr_evd_level(evd), exn[1]));
      } else {
        throw exn;
      }
    }
  };
  return List.fold_left(interp, /* tuple */[
              evd,
              Univ$ReactTemplate.Constraint[/* empty */0]
            ], cstrs);
}

function interp_univ_decl(env, decl) {
  var pl = decl[/* univdecl_instance */0];
  var evd = Evd$ReactTemplate.from_ctx(UState$ReactTemplate.make_with_initial_binders(Environ$ReactTemplate.universes(env), pl));
  var match = interp_univ_constraints(env, evd, decl[/* univdecl_constraints */2]);
  var decl_001 = /* univdecl_extensible_instance */decl[/* univdecl_extensible_instance */1];
  var decl_002 = /* univdecl_constraints */match[1];
  var decl_003 = /* univdecl_extensible_constraints */decl[/* univdecl_extensible_constraints */3];
  var decl$1 = /* record */[
    /* univdecl_instance */pl,
    decl_001,
    decl_002,
    decl_003
  ];
  return /* tuple */[
          match[0],
          decl$1
        ];
}

function interp_univ_decl_opt(env, l) {
  if (l) {
    return interp_univ_decl(env, l[0]);
  } else {
    return /* tuple */[
            Evd$ReactTemplate.from_env(env),
            default_univ_decl
          ];
  }
}

exports.default_univ_decl = default_univ_decl;
exports.interp_univ_decl = interp_univ_decl;
exports.interp_univ_decl_opt = interp_univ_decl_opt;
/* Evd-ReactTemplate Not a pure module */
